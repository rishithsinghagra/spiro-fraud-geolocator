<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Leakage Visualizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=0.5">

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tabulator -->
    <link href="https://unpkg.com/tabulator-tables@6.3.1/dist/css/tabulator.min.css" rel="stylesheet">

    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

    <link rel="stylesheet" href="styles_n.css?v=1.1.5">

    <link rel="icon"
        href="https://cdn.prod.website-files.com/66b0a72103f05e91497d72b7/672df97bd4912f949d26bd48_Spiro%20Fav%20Icon%2032x32.png"
        type="image/png">

    <link rel="apple-touch-icon" href="apple_app_icon.jpg">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <script src="tabulator_esm.js"></script>
</head>

<body>

    <div id="layout">

        <div id="utilPanel" class="gridPanel">
            <input type="file" id="fileInput" accept=".json">


            <h1 id="fileDateTitle">
                No file loaded
            </h1>

            <div id="hourControls">
                <input type="checkbox" id="hourLocalToggle" checked>
                <label for="hourLocalToggle">Show local time (<span id="detectedTimezone">UTC</span>)</label>
            </div>


            <a id="toolChangeButton" href="change_tracker.html" rel="noopener noreferrer" target="_blank">Go To Change
                Tracker</a>

            <button id="userLocButton" onclick="showUserLocation()">Show My Location</button>

        </div>

        <div id="pivotPanel" class="gridPanel">
            <ul id="pivotList" class="pivot-list">
                <li data-value="amperage">Amperage</li>
                <li data-value="country">Country</li>
                <li data-value="centroid_type">Type</li>
                <li data-value="centroid_name">Centroid Name</li>
                <li data-value="hour">Hour</li>
                <li data-value="bms">BMS ID</li>
                <li data-value="last_mapped">Last Mapping</li>
            </ul>

            <button onclick="sort_by_soc(pingTableTabulator)">Sort SOC Lost Descending</button>


            <select id="pivotSelect" name="pivot[]" multiple hidden></select>
        </div>

        <div id="tablePanel" class="gridPanel">
            <div id="pingTable"></div>
        </div>

        <div id="tolerancePanel" class="gridPanel">
            <b>Station Identification Tolerance</b>
            Classify a centroid as its closest station if it is within this range.
            <span>5m<input type="range" id="toleranceSlider" name="Distance" min="5" max="200" value="100">200m</span>
        </div>

        <div id="mapPanel">
            <div id="map"></div>
        </div>

        <div id="centroidPanel" class="gridPanel">

            <h3>Centroid Details</h3>
            <div id="centroidDetails" class="subPanel">Click a centroid.</div>

            <div class="subPanel">

                <div class="chart-box">
                    <canvas id="hourChart"></canvas>
                </div>

                <div class="chart-box">
                    <canvas id="amperageChart"></canvas>
                </div>

                Click on any battery below to see its details:

                <div class="chart-box">
                    <button id="downloadBmsChartButton" onclick="exportBmsChartHTML()">Download BMS Chart as
                        HTML</button>
                    <canvas id="bmsChart"></canvas>
                </div>



            </div>

            <div id="closestStations" class="subPanel"><b>Closest Stations in CRM</b></div>


        </div>

        <div id="batteryPanel" class="gridPanel">

            <h3>Battery Details</h3>
            <div id="batteryDetails" class="subPanel">Select a battery to view details.</div>

            <div class="subPanel" id="SwapFlowBox">
                <b>Chronological Swap and Leakage Events</b>
            </div>
            <div class="subPanel">
                <div class="chart-box">
                    <canvas id="batteryHourChart"></canvas>
                </div>
                <div class="chart-box">
                    <canvas id="batteryAmperageChart"></canvas>
                </div>
                Select a centroid to view details:

                <div class="chart-box">
                    <canvas id="batteryCentroidChart"></canvas>
                </div>
            </div>

        </div>
    </div>


    <script src="logic_n.js?v=1.1.5"></script>
    <!-- HTML -->
    <div id="arrowContainer">
        <div id="arrow1" class="arrow">«</div>
        <div id="arrow2" class="arrow">»</div>
    </div>


</body>

</html>